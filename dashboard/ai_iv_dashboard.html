<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-IV Control System Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: #e0e0e0;
            overflow-x: hidden;
        }

        .header {
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            text-align: center;
            border-bottom: 3px solid #00d4ff;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2em;
            color: #00d4ff;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
            margin-bottom: 5px;
        }

        .header .subtitle {
            color: #88c0d0;
            font-size: 0.9em;
        }

        .status-bar {
            display: flex;
            justify-content: space-around;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid #00d4ff;
        }

        .status-item {
            text-align: center;
        }

        .status-label {
            font-size: 0.8em;
            color: #88c0d0;
            margin-bottom: 5px;
        }

        .status-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #00d4ff;
        }

        .status-value.warning {
            color: #ff9800;
            animation: pulse 1.5s infinite;
        }

        .status-value.critical {
            color: #f44336;
            animation: pulse 0.8s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            padding: 20px;
            max-width: 1800px;
            margin: 0 auto;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 212, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: #00d4ff;
        }

        .card-title {
            font-size: 1.2em;
            color: #00d4ff;
            margin-bottom: 15px;
            border-bottom: 2px solid rgba(0, 212, 255, 0.3);
            padding-bottom: 10px;
        }

        .vital-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .vital-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #00d4ff;
        }

        .vital-label {
            font-size: 0.85em;
            color: #88c0d0;
            margin-bottom: 8px;
        }

        .vital-value {
            font-size: 1.6em;
            font-weight: bold;
            color: #fff;
        }

        .vital-unit {
            font-size: 0.8em;
            color: #88c0d0;
            margin-left: 5px;
        }

        .chart-container {
            position: relative;
            height: 250px;
            margin-top: 10px;
        }

        .energy-bar {
            height: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            margin: 10px 0;
        }

        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, #f44336 0%, #ff9800 50%, #4caf50 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: bold;
        }

        .control-panel {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
        }

        .control-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
        }

        .control-label {
            color: #88c0d0;
            font-size: 0.9em;
        }

        .control-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #00d4ff;
        }

        .alert-panel {
            background: rgba(255, 152, 0, 0.1);
            border: 2px solid #ff9800;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .alert-panel.active {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .alert-title {
            color: #ff9800;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .alert-item {
            color: #ffb74d;
            padding: 5px 0;
            font-size: 0.9em;
        }

        .prediction-box {
            background: rgba(0, 212, 255, 0.1);
            border: 2px dashed #00d4ff;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .prediction-title {
            color: #00d4ff;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .prediction-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            color: #b0e0e6;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 10px;
        }

        .status-indicator.good { background: #4caf50; box-shadow: 0 0 10px #4caf50; }
        .status-indicator.warning { background: #ff9800; box-shadow: 0 0 10px #ff9800; }
        .status-indicator.critical { background: #f44336; box-shadow: 0 0 10px #f44336; }

        .metric-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
            margin: 5px 5px 5px 0;
        }

        .badge-good { background: rgba(76, 175, 80, 0.3); color: #81c784; }
        .badge-warning { background: rgba(255, 152, 0, 0.3); color: #ffb74d; }
        .badge-critical { background: rgba(244, 67, 54, 0.3); color: #e57373; }

        .footer {
            text-align: center;
            padding: 20px;
            color: #88c0d0;
            font-size: 0.85em;
        }

        .wide-card {
            grid-column: span 2;
        }

        @media (max-width: 1200px) {
            .wide-card {
                grid-column: span 1;
            }
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            .vital-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚öïÔ∏è AI-IV Control System Dashboard</h1>
        <p class="subtitle">Real-time Adaptive Intravenous Therapy Monitoring | Enhanced Energy Transfer Model v2.0</p>
    </div>

    <div class="status-bar">
        <div class="status-item">
            <div class="status-label">System Status</div>
            <div class="status-value" id="systemStatus">ACTIVE</div>
        </div>
        <div class="status-item">
            <div class="status-label">Infusion Rate</div>
            <div class="status-value" id="infusionRate">0.85 ml/min</div>
        </div>
        <div class="status-item">
            <div class="status-label">24h Volume</div>
            <div class="status-value" id="totalVolume">1,247 ml</div>
        </div>
        <div class="status-item">
            <div class="status-label">Session Time</div>
            <div class="status-value" id="sessionTime">00:00:00</div>
        </div>
    </div>

    <div class="container">
        <!-- Vital Signs Card -->
        <div class="card">
            <div class="card-title">üìä Vital Signs</div>
            <div class="vital-grid">
                <div class="vital-item">
                    <div class="vital-label">Hydration</div>
                    <div class="vital-value">
                        <span id="hydration">72</span><span class="vital-unit">%</span>
                        <span class="status-indicator good" id="hydrationStatus"></span>
                    </div>
                </div>
                <div class="vital-item">
                    <div class="vital-label">Heart Rate</div>
                    <div class="vital-value">
                        <span id="heartRate">78</span><span class="vital-unit">bpm</span>
                        <span class="status-indicator good" id="hrStatus"></span>
                    </div>
                </div>
                <div class="vital-item">
                    <div class="vital-label">SpO‚ÇÇ</div>
                    <div class="vital-value">
                        <span id="spo2">97</span><span class="vital-unit">%</span>
                        <span class="status-indicator good" id="spo2Status"></span>
                    </div>
                </div>
                <div class="vital-item">
                    <div class="vital-label">Temperature</div>
                    <div class="vital-value">
                        <span id="temp">37.2</span><span class="vital-unit">¬∞C</span>
                        <span class="status-indicator good" id="tempStatus"></span>
                    </div>
                </div>
                <div class="vital-item">
                    <div class="vital-label">Lactate</div>
                    <div class="vital-value">
                        <span id="lactate">2.3</span><span class="vital-unit">mmol/L</span>
                        <span class="status-indicator good" id="lactateStatus"></span>
                    </div>
                </div>
                <div class="vital-item">
                    <div class="vital-label">Cardiac Output</div>
                    <div class="vital-value">
                        <span id="cardiacOutput">5.2</span><span class="vital-unit">L/min</span>
                        <span class="status-indicator good" id="coStatus"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Energy Transfer Card -->
        <div class="card">
            <div class="card-title">‚ö° Energy Transfer Dynamics</div>
            <div class="vital-item" style="margin-bottom: 15px;">
                <div class="vital-label">Energy Proxy (E_T)</div>
                <div class="energy-bar">
                    <div class="energy-fill" id="energyBar" style="width: 75%">0.75</div>
                </div>
            </div>
            <div class="vital-item">
                <div class="vital-label">Absolute Energy Transfer</div>
                <div class="vital-value">
                    <span id="energyAbsolute">3.42</span><span class="vital-unit">W/kg</span>
                </div>
            </div>
            <div class="control-panel">
                <div class="control-row">
                    <span class="control-label">Flow Velocity (v)</span>
                    <span class="control-value"><span id="flowVelocity">22.5</span> cm/s</span>
                </div>
                <div class="control-row">
                    <span class="control-label">Flow Efficiency G(v)</span>
                    <span class="control-value"><span id="flowEfficiency">0.89</span></span>
                </div>
                <div class="control-row">
                    <span class="control-label">Metabolic Load</span>
                    <span class="control-value"><span id="metabolicLoad">0.42</span></span>
                </div>
                <div class="control-row">
                    <span class="control-label">Tissue Efficiency (Œ∑)</span>
                    <span class="control-value"><span id="tissueEfficiency">0.78</span></span>
                </div>
            </div>
        </div>

        <!-- Risk Assessment Card -->
        <div class="card">
            <div class="card-title">‚ö†Ô∏è Risk Assessment</div>
            <div class="vital-item">
                <div class="vital-label">Composite Risk Score</div>
                <div class="vital-value">
                    <span id="riskScore">0.28</span>
                    <span class="status-indicator good" id="riskStatus"></span>
                </div>
                <div style="margin-top: 15px;">
                    <span class="metric-badge badge-good" id="criticalBadge">Critical: 0.12</span>
                    <span class="metric-badge badge-good" id="metabolicBadge">Metabolic: 0.18</span>
                    <span class="metric-badge badge-good" id="thermalBadge">Thermal: 0.05</span>
                </div>
            </div>
            <div class="vital-item" style="margin-top: 15px;">
                <div class="vital-label">Cardiac Reserve</div>
                <div class="energy-bar">
                    <div class="energy-fill" id="cardiacBar" style="width: 68%; background: linear-gradient(90deg, #f44336 0%, #ff9800 30%, #4caf50 100%)">0.68</div>
                </div>
            </div>
            <div class="vital-item" style="margin-top: 15px;">
                <div class="vital-label">Signal Coherence (œÉ)</div>
                <div class="energy-bar">
                    <div class="energy-fill" id="coherenceBar" style="width: 87%; background: linear-gradient(90deg, #2196f3, #00d4ff)">0.87</div>
                </div>
            </div>
        </div>

        <!-- Control System Card -->
        <div class="card">
            <div class="card-title">üéõÔ∏è Control System</div>
            <div class="control-panel">
                <div class="control-row">
                    <span class="control-label">Desired Rate</span>
                    <span class="control-value"><span id="desiredRate">0.92</span> ml/min</span>
                </div>
                <div class="control-row">
                    <span class="control-label">Safety Limited Rate</span>
                    <span class="control-value"><span id="actualRate">0.85</span> ml/min</span>
                </div>
                <div class="control-row">
                    <span class="control-label">Confidence</span>
                    <span class="control-value"><span id="confidence">0.91</span></span>
                </div>
                <div class="control-row">
                    <span class="control-label">Hydration Urgency</span>
                    <span class="control-value"><span id="hydrationUrgency">0.35</span></span>
                </div>
                <div class="control-row">
                    <span class="control-label">Energy Need</span>
                    <span class="control-value"><span id="energyNeed">0.28</span></span>
                </div>
            </div>
            
            <div class="prediction-box">
                <div class="prediction-title">üìà 10-Min Prediction</div>
                <div class="prediction-item">
                    <span>Hydration:</span>
                    <span id="predHydration">69% (‚Üì3%)</span>
                </div>
                <div class="prediction-item">
                    <span>Energy_T:</span>
                    <span id="predEnergy">0.72 (‚Üì0.03)</span>
                </div>
                <div class="prediction-item">
                    <span>Action:</span>
                    <span id="predAction" style="color: #4caf50">Nominal</span>
                </div>
            </div>
        </div>

        <!-- Hydration Trend Chart -->
        <div class="card wide-card">
            <div class="card-title">üíß Hydration & Energy Trends (30 min)</div>
            <div class="chart-container">
                <canvas id="hydrationChart"></canvas>
            </div>
        </div>

        <!-- Infusion Rate Chart -->
        <div class="card wide-card">
            <div class="card-title">üíâ Infusion Rate & Cardiac Reserve</div>
            <div class="chart-container">
                <canvas id="infusionChart"></canvas>
            </div>
        </div>

        <!-- Alerts Panel -->
        <div class="card wide-card">
            <div class="card-title">üö® System Alerts & Warnings</div>
            <div id="alertsContainer">
                <p style="color: #88c0d0; text-align: center; padding: 20px;">No active warnings</p>
            </div>
        </div>
    </div>

    <div class="footer">
        AI-Optimized Intravenous Therapy Control System v2.0 | Enhanced Energy Transfer Model<br>
        White Paper Implementation - Section 4.1 Full Dynamics | MIT License
    </div>

    <script>
        // Simulation state
        let simTime = 0;
        let sessionStartTime = Date.now();
        const dataPoints = {
            time: [],
            hydration: [],
            energy: [],
            infusion: [],
            cardiac: [],
            risk: []
        };
        const maxDataPoints = 90; // 30 minutes at 5Hz / display every 10s

        // Chart configurations
        const chartConfig = {
            type: 'line',
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: { duration: 0 },
                plugins: {
                    legend: { 
                        labels: { color: '#e0e0e0' },
                        display: true
                    }
                },
                scales: {
                    x: {
                        ticks: { color: '#88c0d0' },
                        grid: { color: 'rgba(136, 192, 208, 0.1)' }
                    },
                    y: {
                        ticks: { color: '#88c0d0' },
                        grid: { color: 'rgba(136, 192, 208, 0.1)' }
                    }
                }
            }
        };

        // Initialize charts
        const hydrationChart = new Chart(document.getElementById('hydrationChart'), {
            ...chartConfig,
            data: {
                labels: [],
                datasets: [
                    {
                        label: 'Hydration (%)',
                        data: [],
                        borderColor: '#00d4ff',
                        backgroundColor: 'rgba(0, 212, 255, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y'
                    },
                    {
                        label: 'Energy_T',
                        data: [],
                        borderColor: '#4caf50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                ...chartConfig.options,
                scales: {
                    ...chartConfig.options.scales,
                    y: {
                        ...chartConfig.options.scales.y,
                        position: 'left',
                        min: 0,
                        max: 100,
                        title: { display: true, text: 'Hydration (%)', color: '#00d4ff' }
                    },
                    y1: {
                        ...chartConfig.options.scales.y,
                        position: 'right',
                        min: 0,
                        max: 1,
                        grid: { drawOnChartArea: false },
                        title: { display: true, text: 'Energy_T', color: '#4caf50' }
                    }
                }
            }
        });

        const infusionChart = new Chart(document.getElementById('infusionChart'), {
            ...chartConfig,
            data: {
                labels: [],
                datasets: [
                    {
                        label: 'Infusion Rate (ml/min)',
                        data: [],
                        borderColor: '#ff9800',
                        backgroundColor: 'rgba(255, 152, 0, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y'
                    },
                    {
                        label: 'Cardiac Reserve',
                        data: [],
                        borderColor: '#e91e63',
                        backgroundColor: 'rgba(233, 30, 99, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                ...chartConfig.options,
                scales: {
                    ...chartConfig.options.scales,
                    y: {
                        ...chartConfig.options.scales.y,
                        position: 'left',
                        min: 0,
                        max: 2,
                        title: { display: true, text: 'Rate (ml/min)', color: '#ff9800' }
                    },
                    y1: {
                        ...chartConfig.options.scales.y,
                        position: 'right',
                        min: 0,
                        max: 1,
                        grid: { drawOnChartArea: false },
                        title: { display: true, text: 'Reserve', color: '#e91e63' }
                    }
                }
            }
        });

        // Status indicator helper
        function getStatusClass(value, thresholds) {
            if (value < thresholds.critical || value > thresholds.criticalHigh) return 'critical';
            if (value < thresholds.warning || value > thresholds.warningHigh) return 'warning';
            return 'good';
        }

        // Update dashboard
        function updateDashboard() {
            simTime += 0.2; // 200ms increments
            
            // Simulate telemetry (matching C++ simulation)
            const hydration = 65 + 15 * Math.sin(simTime * 0.05);
            const heartRate = 70 + 20 * Math.sin(simTime * 0.1);
            const spo2 = 97 + 2 * Math.sin(simTime * 0.08);
            const temp = 37.0 + 0.5 * Math.sin(simTime * 0.03);
            const lactate = 2.0 + 1.0 * Math.sin(simTime * 0.04);
            const fatigue = 0.3 + 0.2 * Math.sin(simTime * 0.02);
            const cardiacOutput = 5.0 + 1.0 * Math.sin(simTime * 0.06);
            
            // Calculate energy proxy
            const h_term = 1 / (1 + Math.exp(-0.1 * (hydration - 60)));
            const f_term = fatigue < 0.7 ? (1 - fatigue) : 0.3 * (1 - fatigue);
            const o_term = 1 / (1 + Math.exp(-0.3 * (spo2 - 92)));
            const l_term = Math.exp(-0.5 * Math.max(0, lactate - 2.0));
            const energyT = 0.30 * h_term + 0.25 * 1.0 + 0.20 * f_term + 0.15 * o_term + 0.10 * l_term;
            
            // Flow dynamics
            const flowVelocity = (cardiacOutput * 4.0 + 0.85 * 0.5) / 75;
            const flowEfficiency = Math.exp(-0.5 * Math.pow((flowVelocity - 20) / 5, 2));
            
            // Cardiac reserve
            const maxHR = 220 - 35;
            const cardiacReserve = 1 - (1 / (1 + Math.exp(-10 * (heartRate / maxHR - 0.85))));
            
            // Risk score
            const dehydrationRisk = Math.max(0, Math.min(1, (100 - hydration) / 50));
            const energyDepletionRisk = 1 - energyT;
            const metabolicRisk = 0.4 * dehydrationRisk + 0.6 * energyDepletionRisk;
            const riskScore = 0.6 * 0.0 + 0.3 * metabolicRisk + 0.1 * 0.0;
            
            // Control calculation
            const hydrationDeficit = (100 - hydration) / 100;
            const hydrationUrgency = hydrationDeficit < 0.5 ? hydrationDeficit : 
                1 / (1 + Math.exp(-5 * (hydrationDeficit - 0.5)));
            const energyGap = 1 - energyT;
            const metabolicLoad = 0.3 * (heartRate - 60) / 100 + 0.25 * Math.abs(temp - 37) / 3 + 
                                  0.25 * lactate / 10 + 0.2 * 0.2;
            const energyNeed = energyGap * (1 + 0.5 * metabolicLoad);
            const riskAmplifier = 1 + 0.5 * riskScore;
            
            let infusionRate = 0.4 + 1.4 * Math.max(0, Math.min(1, 
                (0.6 * hydrationUrgency + 0.4 * energyNeed) * riskAmplifier));
            
            // Coherence modulation
            const coherence = 0.85 + 0.1 * Math.sin(simTime * 0.5);
            infusionRate *= coherence;
            
            // Cardiac limiting
            if (cardiacReserve < 0.3) {
                const scaling = 0.5 + 0.5 * (1 / (1 + Math.exp(-10 * (cardiacReserve - 0.3))));
                infusionRate *= scaling;
            }
            
            infusionRate = Math.max(0.1, Math.min(1.5, infusionRate));
            
            // Absolute energy transfer
            const P_input = 100 + 35;
            const m_dot = infusionRate / 60000;
            const I_sp = 1.2;
            const eta = 0.75;
            const energyAbsolute = (P_input * flowEfficiency * m_dot * I_sp * eta) / 75;
            
            // Update UI
            document.getElementById('hydration').textContent = hydration.toFixed(1);
            document.getElementById('heartRate').textContent = Math.round(heartRate);
            document.getElementById('spo2').textContent = Math.round(spo2);
            document.getElementById('temp').textContent = temp.toFixed(1);
            document.getElementById('lactate').textContent = lactate.toFixed(1);
            document.getElementById('cardiacOutput').textContent = cardiacOutput.toFixed(1);
            
            document.getElementById('energyBar').style.width = (energyT * 100) + '%';
            document.getElementById('energyBar').textContent = energyT.toFixed(2);
            document.getElementById('energyAbsolute').textContent = energyAbsolute.toFixed(2);
            document.getElementById('flowVelocity').textContent = flowVelocity.toFixed(1);
            document.getElementById('flowEfficiency').textContent = flowEfficiency.toFixed(2);
            document.getElementById('metabolicLoad').textContent = metabolicLoad.toFixed(2);
            document.getElementById('tissueEfficiency').textContent = '0.78';
            
            document.getElementById('riskScore').textContent = riskScore.toFixed(2);
            document.getElementById('cardiacBar').style.width = (cardiacReserve * 100) + '%';
            document.getElementById('cardiacBar').textContent = cardiacReserve.toFixed(2);
            document.getElementById('coherenceBar').style.width = (coherence * 100) + '%';
            document.getElementById('coherenceBar').textContent = coherence.toFixed(2);
            
            document.getElementById('desiredRate').textContent = infusionRate.toFixed(2);
            document.getElementById('actualRate').textContent = infusionRate.toFixed(2);
            document.getElementById('confidence').textContent = (1 - (1 - coherence * (1 - 0.3 * metabolicLoad))).toFixed(2);
            document.getElementById('hydrationUrgency').textContent = hydrationUrgency.toFixed(2);
            document.getElementById('energyNeed').textContent = energyNeed.toFixed(2);
            
            document.getElementById('infusionRate').textContent = infusionRate.toFixed(2) + ' ml/min';
            document.getElementById('totalVolume').textContent = Math.round(simTime * infusionRate * 60 / 200).toLocaleString() + ' ml';
            
            // Update status indicators
            document.getElementById('hydrationStatus').className = 'status-indicator ' + 
                getStatusClass(hydration, { critical: 50, warning: 60, criticalHigh: 100, warningHigh: 100 });
            document.getElementById('hrStatus').className = 'status-indicator ' + 
                getStatusClass(heartRate, { critical: 50, warning: 60, criticalHigh: 120, warningHigh: 100 });
            document.getElementById('spo2Status').className = 'status-indicator ' + 
                getStatusClass(spo2, { critical: 85, warning: 90, criticalHigh: 100, warningHigh: 100 });
            document.getElementById('tempStatus').className = 'status-indicator ' + 
                getStatusClass(temp, { critical: 35, warning: 36, criticalHigh: 39, warningHigh: 38.5 });
            document.getElementById('lactateStatus').className = 'status-indicator ' + 
                getStatusClass(lactate, { critical: 0, warning: 0, criticalHigh: 4, warningHigh: 3 });
            document.getElementById('coStatus').className = 'status-indicator good';
            document.getElementById('riskStatus').className = 'status-indicator ' + 
                getStatusClass(riskScore, { critical: 0.75, warning: 0.5, criticalHigh: 1, warningHigh: 1 });
            
            // Predictions
            const predHydration = hydration - 3;
            const predEnergy = energyT - 0.03;
            document.getElementById('predHydration').textContent = predHydration.toFixed(0) + '% (‚Üì3%)';
            document.getElementById('predEnergy').textContent = predEnergy.toFixed(2) + ' (‚Üì0.03)';
            
            if (predHydration < 50) {
                document.getElementById('predAction').textContent = '‚ö†Ô∏è Preemptive boost +20%';
                document.getElementById('predAction').style.color = '#ff9800';
            } else {
                document.getElementById('predAction').textContent = 'Nominal';
                document.getElementById('predAction').style.color = '#4caf50';
            }
            
            // Risk badges
            document.getElementById('criticalBadge').textContent = 'Critical: 0.00';
            document.getElementById('criticalBadge').className = 'metric-badge badge-good';
            document.getElementById('metabolicBadge').textContent = 'Metabolic: ' + metabolicRisk.toFixed(2);
            document.getElementById('metabolicBadge').className = 'metric-badge ' + 
                (metabolicRisk > 0.5 ? 'badge-warning' : 'badge-good');
            document.getElementById('thermalBadge').textContent = 'Thermal: ' + (Math.abs(temp - 37) / 3).toFixed(2);
            document.getElementById('thermalBadge').className = 'metric-badge badge-good';
            
            // Alerts
            const alerts = [];
            if (hydration < 60) alerts.push('‚ö†Ô∏è Hydration below optimal threshold (60%)');
            if (heartRate > 100) alerts.push('‚ö†Ô∏è Elevated heart rate detected');
            if (riskScore > 0.5) alerts.push('‚ö†Ô∏è Moderate risk level - enhanced monitoring');
            if (cardiacReserve < 0.3) alerts.push('üö® Low cardiac reserve - infusion limited');
            if (energyT < 0.6) alerts.push('‚ö†Ô∏è Energy depletion detected');
            
            const alertsContainer = document.getElementById('alertsContainer');
            if (alerts.length > 0) {
                alertsContainer.innerHTML = alerts.map(a => `<div class="alert-item">${a}</div>`).join('');
                alertsContainer.parentElement.style.border = '2px solid ' + (alerts.some(a => a.includes('üö®')) ? '#f44336' : '#ff9800');
            } else {
                alertsContainer.innerHTML = '<p style="color: #88c0d0; text-align: center; padding: 20px;">‚úì No active warnings - all systems nominal</p>';
                alertsContainer.parentElement.style.border = '2px solid rgba(76, 175, 80, 0.5)';
            }
            
            // Update charts every 10 seconds
            if (Math.round(simTime * 10) % 100 === 0) {
                const timeLabel = Math.floor(simTime / 60) + ':' + String(Math.floor(simTime % 60)).padStart(2, '0');
                
                dataPoints.time.push(timeLabel);
                dataPoints.hydration.push(hydration);
                dataPoints.energy.push(energyT);
                dataPoints.infusion.push(infusionRate);
                dataPoints.cardiac.push(cardiacReserve);
                dataPoints.risk.push(riskScore);
                
                if (dataPoints.time.length > maxDataPoints) {
                    dataPoints.time.shift();
                    dataPoints.hydration.shift();
                    dataPoints.energy.shift();
                    dataPoints.infusion.shift();
                    dataPoints.cardiac.shift();
                    dataPoints.risk.shift();
                }
                
                hydrationChart.data.labels = dataPoints.time;
                hydrationChart.data.datasets[0].data = dataPoints.hydration;
                hydrationChart.data.datasets[1].data = dataPoints.energy.map(e => e * 100);
                hydrationChart.update();
                
                infusionChart.data.labels = dataPoints.time;
                infusionChart.data.datasets[0].data = dataPoints.infusion;
                infusionChart.data.datasets[1].data = dataPoints.cardiac;
                infusionChart.update();
            }
            
            // Session time
            const elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
            const hours = String(Math.floor(elapsed / 3600)).padStart(2, '0');
            const minutes = String(Math.floor((elapsed % 3600) / 60)).padStart(2, '0');
            const seconds = String(elapsed % 60).padStart(2, '0');
            document.getElementById('sessionTime').textContent = `${hours}:${minutes}:${seconds}`;
            
            // System status
            const statusEl = document.getElementById('systemStatus');
            if (riskScore > 0.75) {
                statusEl.textContent = 'HIGH RISK';
                statusEl.className = 'status-value critical';
            } else if (riskScore > 0.5) {
                statusEl.textContent = 'CAUTION';
                statusEl.className = 'status-value warning';
            } else {
                statusEl.textContent = 'ACTIVE';
                statusEl.className = 'status-value';
            }
        }
        
        // Start simulation at 5Hz (200ms)
        setInterval(updateDashboard, 200);
        
        // Initial update
        updateDashboard();
    </script>
</body>
</html>
